<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="系统调用笔记下"><meta name="keywords" content="系统调用,驱动学习"><meta name="author" content="yangruiqi,undefined"><meta name="copyright" content="yangruiqi"><title>系统调用笔记下 | manyouyou</title><link rel="shortcut icon" href="/favicon.ico"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css?version=1.5.5"><link rel="dns-prefetch" href="https://cdn.staticfile.org"><link rel="dns-prefetch" href="https://cdn.bootcss.com"><link rel="dns-prefetch" href="https://creativecommons.org"><link rel="dns-prefetch" href="https://unpkg.com"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/gitment/style/default.min.css"><script src="https://cdn.jsdelivr.net/npm/gitment/dist/gitment.browser.min.js"></script><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  localSearch: {"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}"},"path":"search.xml"}
} </script></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar"><div class="toggle-sidebar-info text-center"><span data-toggle="切换文章详情">切换站点概览</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#API函数的调用过程（SystemServiceTable）"><span class="toc-number">1.</span> <span class="toc-text">API函数的调用过程（SystemServiceTable）</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#SystemServiceTable-系统服务表"><span class="toc-number">1.1.</span> <span class="toc-text">SystemServiceTable 系统服务表</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#判断要调用的函数在哪个表"><span class="toc-number">1.2.</span> <span class="toc-text">判断要调用的函数在哪个表</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#API函数的调用过程（SSDT）"><span class="toc-number">1.3.</span> <span class="toc-text">API函数的调用过程（SSDT）</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#参考资料："><span class="toc-number">2.</span> <span class="toc-text">参考资料：</span></a></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="https://raw.githubusercontent.com/yangruiqiyr/MarkdownPhotos/master/%E5%A4%B4%E5%83%8F/touxiang.jpg"></div><div class="author-info__name text-center">yangruiqi</div><div class="author-info__description text-center"></div><div class="follow-button"><a href="https://github.com/yangruiqiyr" target="_blank">跟随我</a></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">文章</span><span class="pull-right">11</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">标签</span><span class="pull-right">14</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">分类</span><span class="pull-right">5</span></a></div><hr><div class="author-info-links"><div class="author-info-links__title text-center">相关网址</div><a class="author-info-links__name text-center" href="https://www.baidu.com/" target="_blank">百度</a><a class="author-info-links__name text-center" href="https://bbs.pediy.com/" target="_blank">看雪</a><a class="author-info-links__name text-center" href="http://www.freebuf.com/" target="_blank">FreeBuf</a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(https://raw.githubusercontent.com/yangruiqiyr/MarkdownPhotos/master/主题/主题1.jpg)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">manyouyou</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus"><a class="site-page" href="/">主页</a><a class="site-page" href="/archives">档案</a><a class="site-page" href="/tags">标题</a><a class="site-page" href="/categories">分类</a></span></div><div id="post-info"><div id="post-title">系统调用笔记下</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-06-30</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/笔记-系统调用笔记/">笔记 - 系统调用笔记</a></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h1 id="API函数的调用过程（SystemServiceTable）"><a href="#API函数的调用过程（SystemServiceTable）" class="headerlink" title="API函数的调用过程（SystemServiceTable）"></a>API函数的调用过程（SystemServiceTable）</h1><p>在上中，讲到进0环后，3环的各种寄存器都会保留到<br>_Trap_Frame结构体中，这篇我讲解</p>
<p>如何根据系统服务号(eax中存储)找到要执行的内核函数？<br>调用时参数是存储到3环的堆栈，如何传递给内核函数？</p>
<h2 id="SystemServiceTable-系统服务表"><a href="#SystemServiceTable-系统服务表" class="headerlink" title="SystemServiceTable 系统服务表"></a>SystemServiceTable 系统服务表</h2><p><img src="https://yangruiqi.oss-cn-beijing.aliyuncs.com/8.png" alt="系统服务表"><br>ServiceTable存了系统服务表里函数地址表（4字节）<br>Count是当前系统服务表被调用了几次<br>serviceLimit存了有多少个函数<br>ArgmentTable存了有多少个参数（以字节为单位，比如穿了2个参数，每个参数4字节，所以这里存8，一个单元1字节）<br>绿色的是导出的函数      </p>
<p>黄色结构是一样的，区别就是绿色的是Ntoskrl.exe的，黄色的是Win32k.sys（图形显示之类的模块）的。   </p>
<p>那么程序执行的时候去哪找系统服务表，是_KTHREAD的偏移0xE0处。</p>
<p>下面系统服务号eax怎么找这个对应的函数呢，虽然eax32位，真正使用的只有13位，如下</p>
<h2 id="判断要调用的函数在哪个表"><a href="#判断要调用的函数在哪个表" class="headerlink" title="判断要调用的函数在哪个表"></a>判断要调用的函数在哪个表</h2><p><img src="https://yangruiqi.oss-cn-beijing.aliyuncs.com/10.png" alt="系统服务号"><br>低12位找对应偏移的函数，相同维序的参数表就是这个函数的参数。<br>下面来分析代码，2种调用除了开始寄存器保存不一样（KiSystemServer多做了一些读取内存寄存器的操作），后来都执行相同的代码所以直接开始分析KiSystemServer执行完跳转到KiFastCallEntry里的代码</p>
<p>下面先列一下不同于KiSystemServer，KiFastCallEntry多用到的结构体</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">kd&gt; dt _KTSS</span><br><span class="line">nt!_KTSS</span><br><span class="line">   +0x000 Backlink         : Uint2B</span><br><span class="line">   +0x002 Reserved0        : Uint2B</span><br><span class="line">   +0x004 Esp0             : Uint4B</span><br><span class="line">   +0x008 Ss0              : Uint2B</span><br><span class="line">   +0x00a Reserved1        : Uint2B</span><br><span class="line">   +0x00c NotUsed1         : [4] Uint4B</span><br><span class="line">   +0x01c CR3              : Uint4B</span><br><span class="line">   +0x020 Eip              : Uint4B</span><br><span class="line">   +0x024 EFlags           : Uint4B</span><br><span class="line">   +0x028 Eax              : Uint4B</span><br><span class="line">   +0x02c Ecx              : Uint4B</span><br><span class="line">   +0x030 Edx              : Uint4B</span><br><span class="line">   +0x034 Ebx              : Uint4B</span><br><span class="line">   +0x038 Esp              : Uint4B</span><br><span class="line">   +0x03c Ebp              : Uint4B</span><br><span class="line">   +0x040 Esi              : Uint4B</span><br><span class="line">   +0x044 Edi              : Uint4B</span><br><span class="line">   +0x048 Es               : Uint2B</span><br><span class="line">   +0x04a Reserved2        : Uint2B</span><br><span class="line">   +0x04c Cs               : Uint2B</span><br><span class="line">   +0x04e Reserved3        : Uint2B</span><br><span class="line">   +0x050 Ss               : Uint2B</span><br><span class="line">   +0x052 Reserved4        : Uint2B</span><br><span class="line">   +0x054 Ds               : Uint2B</span><br><span class="line">   +0x056 Reserved5        : Uint2B</span><br><span class="line">   +0x058 Fs               : Uint2B</span><br><span class="line">   +0x05a Reserved6        : Uint2B</span><br><span class="line">   +0x05c Gs               : Uint2B</span><br><span class="line">   +0x05e Reserved7        : Uint2B</span><br><span class="line">   +0x060 LDT              : Uint2B</span><br><span class="line">   +0x062 Reserved8        : Uint2B</span><br><span class="line">   +0x064 Flags            : Uint2B</span><br><span class="line">   +0x066 IoMapBase        : Uint2B</span><br><span class="line">   +0x068 IoMaps           : [1] _KiIoAccessMap</span><br><span class="line">   +0x208c IntDirectionMap  : [32] UChar</span><br></pre></td></tr></table></figure>
<p>FS寄存器，在用户层的时候，指向的是TEB，在内核层的时候，指向的是KPC<br>下面是通过IDA观察的_KiSystemService函数   </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br></pre></td><td class="code"><pre><span class="line">.text:0043567E _KiSystemService proc near              ; CODE XREF: ZwAcceptConnectPort(x,x,x,x,x,x)+Cp</span><br><span class="line">.text:0043567E                                         ; ZwAccessCheck(x,x,x,x,x,x,x,x)+Cp ...</span><br><span class="line">.text:0043567E</span><br><span class="line">.text:0043567E arg_0           = dword ptr  4</span><br><span class="line">.text:0043567E</span><br><span class="line">.text:0043567E                 push    0               ; _KTRAP_FRAME +0x064 ErrCode</span><br><span class="line">.text:00435680                 push    ebp             ; 0x060 Ebp,3环寄存器入栈</span><br><span class="line">.text:00435681                 push    ebx             ; 0x05C,ebx</span><br><span class="line">.text:00435682                 push    esi             ; 0x058 Esi</span><br><span class="line">.text:00435683                 push    edi             ; 0x054 Edi</span><br><span class="line">.text:00435684                 push    fs              ; 0x050 SegFs</span><br><span class="line">.text:00435686                 mov     ebx, 30h        ; 为FS寄存器赋值,30就是段选择子，在GDTR找到相应的段描述符，加载到，FS，指向KPCR结构体</span><br><span class="line">.text:0043568B                 mov     fs, bx          ; Windows内核有个特殊的基本要求，就是只要CPU在内核运行，就得使</span><br><span class="line">.text:0043568B                                         ; mov ebx,30 //0011 0000  所以就是0环GDT索引6</span><br><span class="line">.text:0043568B                                         ; mov fs,bx</span><br><span class="line">.text:0043568B                                         ;</span><br><span class="line">.text:0043568B                                         ; 0环的FS.Base指向CPU自己的KPCR，不是指向当前线程</span><br><span class="line">.text:0043568B                                         ; 选择码，0x30的结构分析如下：</span><br><span class="line">.text:0043568B                                         ; 1.bit0~bit1:RPL,Requested Privilege Level,要求运行的级别，这里是0</span><br><span class="line">.text:0043568B                                         ; 2.bit2：找GDT还是IDT，这里是0，GDT</span><br><span class="line">.text:0043568B                                         ; 3.bit3！bit15，是在GDT或者IDT的下标</span><br><span class="line">.text:0043568B                                         ; windbg查看段描述符：834093f2 dc003748</span><br><span class="line">.text:0043568B                                         ; Base:83f2dc00 指向当前的_KPCR</span><br><span class="line">.text:0043568E                 mov     ebx, 23h</span><br><span class="line">.text:00435693                 mov     ds, ebx</span><br><span class="line">.text:00435695                 mov     es, ebx</span><br><span class="line">.text:00435697                 mov     esi, large fs:124h ; 查看下KPCR偏移124h是什么，查训发现是当前CPU所执行线程的_ETHREAD</span><br><span class="line">.text:0043569E                 push    large dword ptr fs:0 ; 保存老的ExceptionList</span><br><span class="line">.text:0043569E                                         ; _KPCR偏移+0x00-&gt;NT_TIB-&gt;ExceptionList</span><br><span class="line">.text:004356A5                 mov     large dword ptr fs:0, 0FFFFFFFFh ; 新的ExceptonList为空白，因为3环的异常链表，不能用，要进0环了</span><br><span class="line">.text:004356B0                 push    dword ptr [esi+13Ah] ; 因为Esi存的_KTHREAD,他的偏移13A存的PreviousMode,</span><br><span class="line">.text:004356B0                                         ; 就是保存老的先前模式到堆栈</span><br><span class="line">.text:004356B0                                         ; 先前模式就是当调用这些代码时候，原来是几环的数就是几，比如原来0环，先前模式就是0，原来3环就是1</span><br><span class="line">.text:004356B0                                         ; 因为有些内核代码可以从0和3调用，但是执行内容不一样，通过这个知道执行什么。</span><br><span class="line">.text:004356B6                 sub     esp, 48h        ; ESP 提升到_KTRAP_FRAME结构体第一个成员，也就是这个结构体指针</span><br><span class="line">.text:004356B9                 mov     ebx, [esp+68h+arg_0] ; 查了下这个位置是3环CS</span><br><span class="line">.text:004356B9                                         ; 所以这句是取出3环压入的参数CS _KTRAP_FRAME + 0x6C</span><br><span class="line">.text:004356BD                 and     ebx, 1          ; 上面的CS跟1与运算</span><br><span class="line">.text:004356BD                                         ; 0环最低位是0,3环最低位为1</span><br><span class="line">.text:004356C0                 mov     [esi+13Ah], bl  ; 上面的运算结果存到esi+0x13Ah这个位置的偏移，就是新的&quot;先前模式&quot;</span><br><span class="line">.text:004356C6                 mov     ebp, esp        ; 抬高栈针,ebp=esp=_KTRAP_FRAME指针</span><br><span class="line">.text:004356C8                 mov     ebx, [esi+128h] ; _KTHTEAD中的TrapFrame给ebx</span><br><span class="line">.text:004356CE                 mov     [ebp+3Ch], ebx  ; 将_KTHREAD中的Trap_Frame暂时存在这个位置后面</span><br><span class="line">.text:004356CE                                         ; //会将这个值取出来，重新恢复给_KTHREAD的Trap_Frame</span><br><span class="line">.text:004356CE                                         ;</span><br><span class="line">.text:004356CE                                         ; 零时存在这</span><br><span class="line">.text:004356D1                 and     dword ptr [ebp+2Ch], 0 ; Dr7清0</span><br><span class="line">.text:004356D5                 test    byte ptr [esi+3], 0DFh ; 查看当前线程是否处于调试状态</span><br><span class="line">.text:004356D5                                         ; 看看是不是-1，</span><br><span class="line">.text:004356D9                 mov     [esi+128h], ebp ; 因为有改变堆栈中的_KTRAP_FRAME,将其重新赋值给_KTHREAD中的TRAPFRAME</span><br><span class="line">.text:004356DF                 cld</span><br><span class="line">.text:004356E0                 jnz     Dr_kss_a        ; 处于调试的话跳转,跳转那边的代码是讲调试寄存器都存到Trap_Frame里</span><br><span class="line">.text:004356E6</span><br><span class="line">.text:004356E6 loc_4356E6:                             ; CODE XREF: Dr_kss_a+Dj</span><br><span class="line">.text:004356E6                                         ; Dr_kss_a+79j</span><br><span class="line">.text:004356E6                 mov     ebx, [ebp+60h]  ; 3环的EPB给ebx</span><br><span class="line">.text:004356E9                 mov     edi, [ebp+68h]  ; 3环的Eip</span><br><span class="line">.text:004356EC                 mov     [ebp+0Ch], edx  ; edx存的3环参数指针：</span><br><span class="line">.text:004356EC                                         ;</span><br><span class="line">.text:004356EC                                         ; _kiFastSystemCall函数</span><br><span class="line">.text:004356EC                                         ;</span><br><span class="line">.text:004356EC                                         ; mov edx，esp</span><br><span class="line">.text:004356EC                                         ;</span><br><span class="line">.text:004356EC                                         ; sysenter</span><br><span class="line">.text:004356EF                 mov     dword ptr [ebp+8], 0BADB0D00h ; 这个是操作系统的标志</span><br><span class="line">.text:004356F6                 mov     [ebp+0], ebx    ; 3环的ebp存储到KTRAP_FRAME+0x000 DbgEbp的位置</span><br><span class="line">.text:004356F9                 mov     [ebp+4], edi    ; 3环的ebp存储到KTRAP_FRAME+0x004 DbgEip的位置</span><br><span class="line">.text:004356FC                 sti</span><br><span class="line">.text:004356FD                 jmp     loc_4357DF      ; 跳到KiFastCallEntry</span><br><span class="line">.text:004356FD _KiSystemService endp</span><br><span class="line">.text:004356FD</span><br><span class="line">.text:00435702</span><br><span class="line">.text:00435702 ; =============== S U B R O U T I N E =======================================</span><br><span class="line">.text:00435702</span><br><span class="line">.text:00435702</span><br><span class="line">.text:00435702 _KiFastCallEntry2 proc near             ; DATA XREF: _KiTrap01:loc_436724o</span><br><span class="line">.text:00435702                 mov     ecx, 30h</span><br><span class="line">.text:00435707                 mov     fs, ecx</span><br><span class="line">.text:00435709                 mov     ecx, 23h</span><br><span class="line">.text:0043570E                 mov     ds, ecx</span><br><span class="line">.text:00435710                 mov     es, ecx</span><br><span class="line">.text:00435712                 mov     ecx, large fs:40h</span><br><span class="line">.text:00435719                 mov     esp, [ecx+4]</span><br><span class="line">.text:0043571C                 push    23h</span><br><span class="line">.text:0043571E                 push    edx</span><br><span class="line">.text:0043571F                 pushf</span><br><span class="line">.text:00435720                 or      byte ptr [esp+1], 1</span><br><span class="line">.text:00435725                 jmp     short loc_43576B ; Sanitize eflags, clear direction, NT etc;设置eflags为2,,表示所有标志位都是0(中断被关闭)，就是清除所有标志位</span><br><span class="line">.text:00435725 _KiFastCallEntry2 endp</span><br><span class="line">.text:00435725</span><br><span class="line">.text:00435727 ; ---------------------------------------------------------------------------</span><br><span class="line">.text:00435727 ; START OF FUNCTION CHUNK FOR _KiFastCallEntry</span><br><span class="line">.text:00435727</span><br><span class="line">.text:00435727 loc_435727:                             ; CODE XREF: _KiFastCallEntry:loc_43574Bj</span><br><span class="line">.text:00435727                 mov     ecx, large fs:40h</span><br><span class="line">.text:0043572E                 mov     esp, [ecx+4]</span><br><span class="line">.text:00435731                 push    0</span><br><span class="line">.text:00435733                 push    0</span><br><span class="line">.text:00435735                 push    0</span><br><span class="line">.text:00435737                 push    0</span><br><span class="line">.text:00435739                 push    23h</span><br><span class="line">.text:0043573B                 push    0</span><br><span class="line">.text:0043573D                 push    20202h</span><br><span class="line">.text:00435742                 push    1Bh</span><br><span class="line">.text:00435744                 push    0</span><br><span class="line">.text:00435746                 jmp     _KiTrap06</span><br><span class="line">.text:0043574B ; ---------------------------------------------------------------------------</span><br><span class="line">.text:0043574B</span><br><span class="line">.text:0043574B loc_43574B:                             ; CODE XREF: _KiFastCallEntry+62j</span><br><span class="line">.text:0043574B                 jmp     short loc_435727</span><br><span class="line">.text:0043574B ; END OF FUNCTION CHUNK FOR _KiFastCallEntry</span><br><span class="line">.text:0043574B ; ---------------------------------------------------------------------------</span><br><span class="line">.text:0043574D                 align 10h</span><br><span class="line">.text:00435750</span><br><span class="line">.text:00435750 ; =============== S U B R O U T I N E =======================================</span><br><span class="line">.text:00435750</span><br><span class="line">.text:00435750 ; ;此时:</span><br><span class="line">.text:00435750 ; ;eax指向服务编号</span><br><span class="line">.text:00435750 ; ;edx指向当前用户栈,edx+8为参数列表</span><br><span class="line">.text:00435750 ;</span><br><span class="line">.text:00435750 ; KGDT_R3_DATA OR RPL_MASK  给ecx</span><br><span class="line">.text:00435750</span><br><span class="line">.text:00435750 _KiFastCallEntry proc near              ; DATA XREF: KiLoadFastSyscallMachineSpecificRegisters(x)+21o</span><br><span class="line">.text:00435750                                         ; _KiTrap01+71o</span><br><span class="line">.text:00435750</span><br><span class="line">.text:00435750 var_7C          = dword ptr -7Ch</span><br><span class="line">.text:00435750 var_B           = byte ptr -0Bh</span><br><span class="line">.text:00435750</span><br><span class="line">.text:00435750 ; FUNCTION CHUNK AT .text:00435727 SIZE 00000026 BYTES</span><br><span class="line">.text:00435750 ; FUNCTION CHUNK AT .text:00435A75 SIZE 00000014 BYTES</span><br><span class="line">.text:00435750 ; FUNCTION CHUNK AT .text:00435BCB SIZE 00000038 BYTES</span><br><span class="line">.text:00435750 ; FUNCTION CHUNK AT .text:00435C04 SIZE 0000001A BYTES</span><br><span class="line">.text:00435750</span><br><span class="line">.text:00435750                 mov     ecx, 23h</span><br><span class="line">.text:00435755                 push    30h             ; 这里的30是KGDT_R0_PCR，也就是0环的GDT的PCR，要给fs，使fs指向KPCR</span><br><span class="line">.text:00435757                 pop     fs              ; 为FS寄存器赋值,30就是段选择子，在GDTR找到相应的段描述符，加载到，FS，指向KPCR结构体</span><br><span class="line">.text:00435759                 mov     ds, ecx         ; ds指向用户数据段</span><br><span class="line">.text:0043575B                 mov     es, ecx         ; es指向用户数据段</span><br><span class="line">.text:0043575D                 mov     ecx, large fs:40h ; 传说中的TSS，保存了一大堆寄存器的值</span><br><span class="line">.text:00435764                 mov     esp, [ecx+4]    ; tts中获得当前线程堆栈的esp,0环ESP给ESP</span><br><span class="line">.text:00435767                 push    23h             ; 23是 KGDT_R3_DATA OR RPL_MASK   ; Push user SS(压入用户态线程的堆栈段寄存器ss)</span><br><span class="line">.text:00435769                 push    edx             ; edx,参数入栈,</span><br><span class="line">.text:00435769                                         ; edx保存的是用户层的堆栈，也就是Push ESP(压入esp)</span><br><span class="line">.text:0043576A                 pushf                   ; 压入标志寄存器</span><br><span class="line">.text:0043576B</span><br><span class="line">.text:0043576B loc_43576B:                             ; CODE XREF: _KiFastCallEntry2+23j</span><br><span class="line">.text:0043576B                 push    2               ; Sanitize eflags, clear direction, NT etc;设置eflags为2,,表示所有标志位都是0(中断被关闭)，就是清除所有标志位</span><br><span class="line">.text:0043576D                 add     edx, 8          ; edx+8就是dex移动到了参数位置</span><br><span class="line">.text:00435770                 popf                    ; .errnz(EFLAGS_INTERRUPT_MASK AND 0FFFF00FFh)</span><br><span class="line">.text:00435771                 or      [esp+0Ch+var_B], 2 ; or byte ptr [esp+1], EFLAGS_INTERRUPT_MASK/0100h ; Enable interrupts in eflags(打开用户态eflags的中断)</span><br><span class="line">.text:00435776                 push    1Bh             ; Push user CS</span><br><span class="line">.text:00435778                 push    dword ptr ds:0FFDF0304h ; push return address(使其返回时指向用户空间</span><br><span class="line">.text:00435778                                         ; push dword ptr ds:[USER_SHARED_DATA+UsSystemCallReturn] ;</span><br><span class="line">.text:0043577E                 push    0               ; put pad dword for error on stack</span><br><span class="line">.text:00435780                 push    ebp             ;  save the non-volatile registers</span><br><span class="line">.text:00435781                 push    ebx</span><br><span class="line">.text:00435782                 push    esi</span><br><span class="line">.text:00435783                 push    edi             ; 保存现场</span><br><span class="line">.text:00435784                 mov     ebx, large fs:1Ch ; Ptr32 _KPCR     指向KPCR自己</span><br><span class="line">.text:0043578B                 push    3Bh             ; Push user mode FS</span><br><span class="line">.text:0043578B                                         ; push KGDT_R3_TEB OR RPL_MASK</span><br><span class="line">.text:0043578D                 mov     esi, [ebx+124h] ; esi为指向当前线程的结构体KTHREAD</span><br><span class="line">.text:00435793                 push    dword ptr [ebx] ; 吧KPCR入栈</span><br><span class="line">.text:00435795                 mov     dword ptr [ebx], 0FFFFFFFFh ; ebx等于-1</span><br><span class="line">.text:0043579B                 mov     ebp, [esi+28h]  ; 这个位置是InitialStack</span><br><span class="line">.text:0043579B                                         ; 使ebp指向当前线程堆栈的栈顶</span><br><span class="line">.text:0043579E                 push    1               ; Save previous mode as user(保存先前模式)</span><br><span class="line">.text:004357A0                 sub     esp, 48h        ; 给ESP分配48h字节, 也就是DbgEbp到Eax所占据的空间</span><br><span class="line">.text:004357A0                                         ; allocate remainder of trap frame</span><br><span class="line">.text:004357A3                 sub     ebp, 29Ch       ; sub ebp, NPX_FRAME_LENGTH + KTRAP_FRAME_LENGTH</span><br><span class="line">.text:004357A3                                         ; 就是ebp指向了 _Ktrap_frame</span><br><span class="line">.text:004357A9                 mov     byte ptr [esi+13Ah], 1 ; esi+0x13Ah这个位置的偏移，就是新的&quot;先前模式&quot;为1，就是之前是从3环调用的这个代码</span><br><span class="line">.text:004357B0                 cmp     ebp, esp        ; 判断堆栈内压入的值是否正确(这些堆栈内压入的东西,就好比一个trap框架)</span><br><span class="line">.text:004357B2                 jnz     short loc_43574B ; 不正确重新来一遍</span><br><span class="line">.text:004357B4                 and     dword ptr [ebp+2Ch], 0 ; sDr7置0</span><br><span class="line">.text:004357B8                 test    byte ptr [esi+3], 0DFh ; 检查是否被调试</span><br><span class="line">.text:004357BC                 mov     [esi+128h], ebp ; 重新把修改过的TrapFrame设置回_KTHREAD的相应参数位置</span><br><span class="line">.text:004357C2                 jnz     Dr_FastCallDrSave ; 处于调试则保存那些寄存器</span><br><span class="line">.text:004357C8</span><br><span class="line">.text:004357C8 loc_4357C8:                             ; CODE XREF: Dr_FastCallDrSave+Dj</span><br><span class="line">.text:004357C8                                         ; Dr_FastCallDrSave+79j</span><br><span class="line">.text:004357C8                 mov     ebx, [ebp+60h]  ; Ebp给ebx</span><br><span class="line">.text:004357CB                 mov     edi, [ebp+68h]  ; eip给Edi</span><br><span class="line">.text:004357CE                 mov     [ebp+0Ch], edx  ; 参数地址给DbgArgPointer</span><br><span class="line">.text:004357D1                 mov     dword ptr [ebp+8], 0BADB0D00h</span><br><span class="line">.text:004357D8                 mov     [ebp+0], ebx    ; 3环ebp给调试DbgEbp</span><br><span class="line">.text:004357DB                 mov     [ebp+4], edi    ; 3环Eip给DbgEip</span><br><span class="line">.text:004357DE                 sti                     ; 开中断，允许硬件中断</span><br><span class="line">.text:004357DF</span><br><span class="line">.text:004357DF loc_4357DF:                             ; CODE XREF: _KiBBTUnexpectedRange+18j</span><br><span class="line">.text:004357DF                                         ; _KiSystemService+7Fj</span><br><span class="line">.text:004357DF                 mov     edi, eax        ; 取出系统调用号，给edi</span><br><span class="line">.text:004357E1                 shr     edi, 8          ; 系统调用号右移8位</span><br><span class="line">.text:004357E4                 and     edi, 10h        ; 将第12位；与1与，得到的数，看看是哪个的系统服务表，是Ntoskrl的还是Win32k.sys的</span><br><span class="line">.text:004357E7                 mov     ecx, edi        ; 调用号给ecx</span><br><span class="line">.text:004357E9                 add     edi, [esi+0BCh] ; edi的值加上ServiceTable，如果0就是第一个表，1就是第二个表</span><br><span class="line">.text:004357E9                                         ; 就是SSDT表</span><br><span class="line">.text:004357EF                 mov     ebx, eax        ; 调用序号给ebx</span><br><span class="line">.text:004357F1                 and     eax, 0FFFh      ; 系统调用号，只要后面12位</span><br><span class="line">.text:004357F6                 cmp     eax, [edi+8]    ; 调用号跟系统表函数总数作比较</span><br><span class="line">.text:004357F9                 jnb     _KiBBTUnexpectedRange ; 大于等于说明越界，到处理越界的地方去</span><br><span class="line">.text:004357FF                 cmp     ecx, 10h        ; 看看是1还是0，就是说看看是哪一张表</span><br><span class="line">.text:00435802                 jnz     short loc_43581E ; 是0，第一张表往上面跳转</span><br><span class="line">.text:00435804                 mov     ecx, [esi+88h]  ; Teb给ecx</span><br><span class="line">.text:0043580A                 xor     esi, esi        ; esi清0</span><br><span class="line">.text:0043580C</span><br><span class="line">.text:0043580C loc_43580C:                             ; DATA XREF: _KiTrap0E+156o</span><br><span class="line">.text:0043580C                 or      esi, [ecx+0F70h]</span><br><span class="line">.text:00435812                 jz      short loc_43581E</span><br><span class="line">.text:00435814                 push    edx</span><br><span class="line">.text:00435815                 push    eax</span><br><span class="line">.text:00435816                 call    ds:_KeGdiFlushUserBatch ; 是第二张表跳转到的函数,一般都是图像相关，动态加载的</span><br><span class="line">.text:0043581C                 pop     eax</span><br><span class="line">.text:0043581D                 pop     edx</span><br><span class="line">.text:0043581E</span><br><span class="line">.text:0043581E loc_43581E:                             ; CODE XREF: _KiFastCallEntry+B2j</span><br><span class="line">.text:0043581E                                         ; _KiFastCallEntry+C2j</span><br><span class="line">.text:0043581E                 inc     large dword ptr fs:6B0h</span><br><span class="line">.text:00435825                 mov     esi, edx        ; edx存储着3环传入函数的指针</span><br><span class="line">.text:00435827                 xor     ecx, ecx</span><br><span class="line">.text:00435829                 mov     edx, [edi+0Ch]  ; edi存的SSDT表，所以这里+0x0Ch是SSDT参数表起始的的地址</span><br><span class="line">.text:0043582C                 mov     edi, [edi]      ; 指向函数表的地址</span><br><span class="line">.text:0043582E                 mov     cl, [eax+edx]   ; eax系统调用号 参数表+调用号得到参数个数</span><br><span class="line">.text:00435831                 mov     edx, [edi+eax*4] ; 0环函数的地址,函数地址表参数4字节</span><br><span class="line">.text:00435834                 sub     esp, ecx        ; 提升堆栈，提高为Cl,因为参数是3环的，要把3环参数存到0环，所以是抬高这么高的栈针</span><br><span class="line">.text:00435836                 shr     ecx, 2          ; 为了下面rep movsd，一次复制4字节，复制ecx次，ecx保存参数个数单位是一字节，所以这里要除以4</span><br><span class="line">.text:00435839                 mov     edi, esp        ; 设置要复制的地址</span><br><span class="line">.text:0043583B                 cmp     esi, ds:_MmUserProbeAddress ; 判断用户函数地址范围有没有越界</span><br><span class="line">.text:00435841                 jnb     loc_435A75</span><br><span class="line">.text:00435847</span><br><span class="line">.text:00435847 loc_435847:                             ; CODE XREF: _KiFastCallEntry+329j</span><br><span class="line">.text:00435847                                         ; DATA XREF: _KiTrap0E:loc_438AD8o</span><br><span class="line">.text:00435847                 rep movsd               ; 开始复制参数</span><br><span class="line">.text:00435849                 test    byte ptr [ebp+6Ch], 1 ; SegCs</span><br><span class="line">.text:0043584D                 jz      short loc_435865</span><br><span class="line">.text:0043584F                 mov     ecx, large fs:124h</span><br><span class="line">.text:00435856                 mov     edi, [esp+7Ch+var_7C]</span><br><span class="line">.text:00435859                 mov     [ecx+13Ch], ebx</span><br><span class="line">.text:0043585F                 mov     [ecx+12Ch], edi</span><br><span class="line">.text:00435865</span><br><span class="line">.text:00435865 loc_435865:                             ; CODE XREF: _KiFastCallEntry+FDj</span><br><span class="line">.text:00435865                 mov     ebx, edx</span><br><span class="line">.text:00435867                 test    byte ptr ds:dword_52E0C8, 40h</span><br><span class="line">.text:0043586E                 setnz   byte ptr [ebp+12h]</span><br><span class="line">.text:00435872                 jnz     loc_435C04</span><br><span class="line">.text:00435878</span><br><span class="line">.text:00435878 loc_435878:                             ; CODE XREF: _KiFastCallEntry+4BBj</span><br><span class="line">.text:00435878                 call    ebx             ; 调用函数</span><br></pre></td></tr></table></figure>
<h2 id="API函数的调用过程（SSDT）"><a href="#API函数的调用过程（SSDT）" class="headerlink" title="API函数的调用过程（SSDT）"></a>API函数的调用过程（SSDT）</h2><p>在上一节课中，我们讲到系统服务表的结构，以及如何找到系统服务<br>表(KTHREAD  0xbc偏移).  </p>
<p>也可以通过SSDT访问<br>SSDT  的全称是 System Services Descriptor Table，系统服务描述符表<br>kd&gt; dd  KeServiceDescriptorTable(SSDT)ntosKrl是内核导出的<br>导出的 声明一下就可以使用了<br>kd&gt; dd  KeServiceDescriptorTableShadow(SSDT Shadow)<br>未导出 需要用其他的方式来查找   </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">kd&gt; dd KeServiceDescriptorTable</span><br><span class="line">83f789c0  83e8cd9c 00000000 00000191 83e8d3e4</span><br><span class="line">83f789d0  00000000 00000000 00000000 00000000</span><br><span class="line">83f789e0  83eeb6af 00000000 025355a9 000000bb</span><br><span class="line">83f789f0  00000011 00000100 5385d2ba d717548f</span><br><span class="line">83f78a00  83e8cd9c 00000000 00000191 83e8d3e4</span><br><span class="line">83f78a10  95d46000 00000000 00000339 95d4702c</span><br><span class="line">83f78a20  00000000 00000000 83f78a24 00000340</span><br><span class="line">83f78a30  00000340 865fab00 00000007 00000000</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">kd&gt; dd KeServiceDescriptorTableShadow</span><br><span class="line">83f78a00  83e8cd9c 00000000 00000191 83e8d3e4</span><br><span class="line">83f78a10  95d46000 00000000 00000339 95d4702c</span><br><span class="line">83f78a20  00000000 00000000 83f78a24 00000340</span><br><span class="line">83f78a30  00000340 865fab00 00000007 00000000</span><br><span class="line">83f78a40  865faa38 865fa7e0 865fa970 865fa8a8</span><br><span class="line">83f78a50  00000000 865fa718 00000000 00000000</span><br><span class="line">83f78a60  83e86809 83e93eed 83ea23a5 00000003</span><br><span class="line">83f78a70  80783000 80784000 00000120 ffffffff</span><br></pre></td></tr></table></figure>
<p>因为KeServiceDescriptorTableShadow没有导出，所以一般采用内存搜索获取这张表   </p>
<h1 id="参考资料："><a href="#参考资料：" class="headerlink" title="参考资料："></a>参考资料：</h1><p>[1]：毛德操，《Windows内核情景分析》<br>[2]：滴水视频<br>[3]: 一大堆的别人的博客，重点博客<a href="https://blog.csdn.net/Sunny_wwc/article/details/5939848" target="_blank" rel="noopener">https://blog.csdn.net/Sunny_wwc/article/details/5939848</a>  </p>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">yangruiqi</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://yoursite.com/2018/06/30/系统调用笔记下/">http://yoursite.com/2018/06/30/系统调用笔记下/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://yoursite.com" target="_blank">manyouyou</a>！</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/系统调用/">系统调用</a><a class="post-meta__tags" href="/tags/驱动学习/">驱动学习</a></div><div class="post-qr-code"><div class="post-qr-code-item"><img class="post-qr-code__img" src="https://raw.githubusercontent.com/yangruiqiyr/MarkdownPhotos/master/收款码/zhifubao.jpg"><div class="post-qr-code__desc">支付宝打赏</div></div><div class="post-qr-code-item"><img class="post-qr-code__img" src="https://raw.githubusercontent.com/yangruiqiyr/MarkdownPhotos/master/收款码/weixin.jpg"><div class="post-qr-code__desc">微信打赏</div></div></div><div class="social-share"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/js/social-share.min.js"></script><nav id="pagination"><div class="prev-post pull-left"><a href="/2018/06/30/通过进程挂靠实现改其它进程的数据/"><i class="fa fa-chevron-left">  </i><span>通过进程挂靠实现改其它进程的数据</span></a></div><div class="next-post pull-right"><a href="/2018/06/30/系统调用笔记上/"><span>系统调用笔记上</span><i class="fa fa-chevron-right"></i></a></div></nav><div id="gitment-container"></div><script>var gitment = new Gitment({
  owner: 'yangruiqiyr',
  repo: 'BlogGitment',
  oauth: {
    client_id: 'dfbfacd2fb59427cee9e',
    client_secret: 'a39b872c7d6ddf551a16ebf9a3d59ce9b57508bb'
  }
})
gitment.render('gitment-container')</script></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2015 - 2018 By yangruiqi</div><div class="framework-info"><span>驱动 - </span><a href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="footer_custom_text">Hi, welcome to my <a href="www.yangruiqiyr.com">blog</a>!</div><div class="busuanzi"><script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file-o"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="/js/third-party/anime.min.js"></script><script src="/js/third-party/jquery.min.js"></script><script src="/js/third-party/jquery.fancybox.min.js"></script><script src="/js/third-party/velocity.min.js"></script><script src="/js/third-party/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.5.5"></script><script src="/js/fancybox.js?version=1.5.5"></script><script src="/js/sidebar.js?version=1.5.5"></script><script src="/js/copy.js?version=1.5.5"></script><script src="/js/fireworks.js?version=1.5.5"></script><script src="/js/transition.js?version=1.5.5"></script><script src="/js/scroll.js?version=1.5.5"></script><script src="/js/head.js?version=1.5.5"></script></body></html>